mBuffer.define('colorAnimate', {path: 'http://testwww.m1905.com/static/mindex/js/jquery.animate-colors.js', type:'js'});mBuffer(function(){	//å›¾ç‰‡è½®æ’­å¤„ç†	$(document).on('active', '.f_out', function(e, a, b){		var len = $(this).find('.file-img').length;		$(this).closest('.carousel').prev().find('.carousel-count').html(a*len + '/' + b*len);	})	//å›¾è¡¨åˆ‡æ¢	.on('click', '[data-chart]', function(){        $(this).addClass('clicked').parent('li').siblings('li').children('a').removeClass('clicked');		var $chart = $('#chart_line');		var type = $(this).attr('href');		type = type && type.replace('#', '');		type = type.length ? type : $chart.data('chart-type');		var cid = $(this).data('chart') || $chart.data('chart-id');		var typename = $(this).text();		$chart.data({			'chart-type': type,			'chart-id': cid		});		$.getJSON('/' + indexCONFIG.type + '/' + cid + '/?mitype=' + type, function(data){			$chart.trigger('change.chart', [typename, data])		});		return false;	});	//tabåˆ‡æ¢è§¦å‘	$('.chart-swh').on('shown', '[data-chart]', function(){			})	//æœç´¢ä¸‹æ‹‰äº‹ä»¶	$('.indexfilm-search').on('click', '.search-select-list li a', function(){		var type = $(this).text(), typeval = $(this).data('shtype');		$('.search-select-name').text(type);		$('#select_type').val(typeval);		$('.search-select-list').slideUp(200);		return false;	})	.on('click', '.index-search-select', function(){		$('.search-select-list').slideToggle(200);	})	//===========================================================	! function ($) {    $.fn.srhfix_enh = function (options) {        var searchEl = $(this).find('input[name=q]'),             searchFix = $(this).find('#fix_q'),                $srhtype = $(this).find('#select_type');        var defaults = {            search_url: $(this).data('srhurl') || '/search/?q=',            fix_url: $(this).data('srhfix_enh') || '/search/sg.php?q=',             tmpl: $(this).find('#srhfix_tmpl').html() || '<li><a href="{surl}" target="_blank">{tag}</a></li>'        };        var btn_index = $(this).find('button[name=index_query_btn]');		$('#fix_q').remove(); 		       	var $inquiryBox = $(this);        var $popupBox = $('<div id="fix_q" class="inq-flaot-div inp-text-div">\        	<ul></ul>\        	<div class="notfound">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç»“æœï¼Œè¯·æ›´æ¢å…³é”®è¯?</div>\        	<div class="limit2words">åªèƒ½è¾“å…¥2ä¸ªå…³é”®è¯è¿›è¡Œå¯¹æ¯”</div>\        	<div class="searchLoading">æ­£åœ¨è½½å…¥ï¼Œè¯·ç¨ä¾¯..</div>\        	<div class="searchError">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å†…å®¹</div>\        	<!--div>æ²¡æœ‰æ‰¾åˆ°æƒ³è¦çš„ç»“æœï¼Œ<a href="#">è¯•è¯•è¿™é‡Œ</a></div-->\        	</div>');        $('body').append($popupBox);        var $popupUL = $('ul',$popupBox);        var _setOffset = function(){	        var offset = $inquiryBox.offset(),	        iboxH = $inquiryBox.outerHeight(),	        offsetTop = offset.top + iboxH;	        $popupBox.css({'left':offset.left+68,'top':offsetTop});        }        _setOffset();        $(window).resize(function(){        	_setOffset();        });        var currVal = '_Val_';        var searchTimer = null;		var tempids = [];		var typeMap = {			'1' :  'film',			'2' :  'star'		}		var data_tmp = {'film':{},'star':{}};		        var setting = $.extend({}, defaults, options);		        $(this).on('click', function (e) {            e.stopPropagation();            e.cancelBubble = true;        })		$popupBox.delegate('li[class!=hd]', {            'mouseenter': function () {                $(this).addClass('select').siblings('li').removeClass('select');            },            'click': function () {				additem($(this).children('a').text(), $(this).data('cid'));				$popupBox.slideUp(200);				searchEl.focus();                return false;            }        });				$(this).find('form').submit(function(e) {			if(!tempids[0]){				$popupBox.show();				$('.searchLoading',$popupBox).hide();				$('.searchError',$popupBox).hide();				$('.notfound',$popupBox).show()            	.animate({backgroundColor:'#fd6'}, 50,function(){            		$(this).css('backgroundColor','#FFDDDD');            	})                .animate({backgroundColor:'#fd6'},100,function(){                    $(this).css('backgroundColor', '#FFBBBB');                })            	.animate({backgroundColor:'#fd6'}, 150,function(){            		$(this).css('backgroundColor','#FFDDDD');            	})                .animate({backgroundColor:'#fd6'},100,function(){                    $(this).css('backgroundColor', '#FFBBBB');                })            	.animate({backgroundColor:'#fd6'}, 150,function(){            		$(this).css('backgroundColor','#f3f3f3');            	})                ;			}			if($popupBox.is(":visible")){				var $li = $('li.select',$popupUL);				if(!$li.length) {					$li = $popupUL.children(":first");				}								$li.click();				if($inquiryBox.data('submitnow') && tempids.length == 1){					var _href = $li.children('a').attr('href');					open(_href);					return false;				}else if(tempids.length != 2){					return false;				}			}			var $list = $popupBox.find('li[class!=hd]');			if ( /(,|ï¼?)\s*.*$/.test(searchEl.val())) {				if(tempids && tempids.length){					open('/' + typeMap[$srhtype.val()] + '/' + tempids.join('/') + '/');					return false;				}			} else {				if($list.length){					open($list.eq(0).children('a').attr('href'));					return false;				} else {					$popupBox.show();					$('.searchLoading',$popupBox).hide();					$('.notfound',$popupBox).hide();					$('.searchError',$popupBox).show()					.animate({backgroundColor:'#fd6'}, 100,function(){            			$(this).css('backgroundColor','#f3f3f3');            		});				}			}			return false;        });        searchEl.keydown(function (e) {	        if(e.keyCode === 13){        		return false;        	}            if (e.keyCode === 38 || e.keyCode === 40) {                 var list = $popupBox.find('li[class!=hd]'),                     listSelected = $popupBox.find('.select');                 if (listSelected.length == 0) {                    $(list[0]).addClass('select');                    replaceItem($(list[0]).children('a').text(), $(list[0]).data('cid'))                } else {                    switch (e.keyCode) {                    case 38:                        var cur = listSelected.prev('li[class!=hd]'),                            cur = cur.length == 0 ? list.last() : cur;                        break;                    case 40:                        var cur = listSelected.next('li[class!=hd]'),                            cur = cur.length == 0 ? $(list[0]) : cur;                        break                    }                    $(cur).addClass('select').siblings().removeClass('select');					replaceItem($(cur).children('a').text(), $(cur).data('cid'))					                }            }        });                 btn_index.click(function(e){            $inquiryBox.data('submitnow',true);            $inquiryBox.find('form').submit();            return false;        });        searchEl.on('focus',function(e){            if(0 == tempids.length){                searchEl.val('');                $('.notfound',$popupBox).hide();            }        });        searchEl.keyup(function (e) {            if(tempids.length == 2 && e.keyCode !== 8){                return false;            }	        if(e.keyCode === 13){	        	$inquiryBox.data('submitnow',true);        		$inquiryBox.find('form').submit();        		return false;        	}        	else{        		$inquiryBox.data('submitnow',false);        	}            if (e.keyCode === 38 || e.keyCode === 40) {                return            }						if(searchTimer){            	window.clearTimeout(searchTimer);            }			            $popupUL.empty().show();            $('.notfound',$popupBox).hide();            $('.limit2words',$popupBox).hide();            $('.searchError',$popupBox).hide();            $('.searchLoading',$popupBox).hide();            var sVal = searchEl.val();            var sMatch = sVal.match(/,|ï¼?/g);            if(sMatch && sMatch.length > 1){            	$popupBox.show();            	$('.limit2words',$popupBox).show();            	return false;            }            if(sVal.match(/\s*(,|ï¼?)\s*$/g) && !tempids[0]){            	sVal = sVal.replace(/\s*(,|ï¼?).*$/,'');            	searchEl.val(sVal);            	$('.searchLoading',$popupBox).hide();            	$('.searchError',$popupBox).hide();            	$('.notfound',$popupBox).show()            	.animate({backgroundColor:'#fd6'}, 100,function(){            		$(this).css('backgroundColor','#f3f3f3');            	});            	return false;            }            var _kw = $.trim(searchEl.val()).split(/(,|ï¼?)\s*/),				kw = _kw[_kw.length-1],                url = setting.fix_url + encodeURIComponent(kw) + ($srhtype.length ? '&t=' + $srhtype.val() : '');				currVal = kw;            if (kw.length == 0){            	if(!$.trim(sVal)){            		tempids = [];            	}            	if(_kw.length == 3 && tempids && tempids[1]){            		delete(tempids[1]);            	}                return;            }            if (data_tmp[typeMap[$srhtype.val()]].hasOwnProperty(kw)) {                renderSrhFix(data_tmp[typeMap[$srhtype.val()]][kw]);                return            }            searchTimer = window.setTimeout(function(){            	$('.searchLoading',$popupBox).show();				$('.searchError',$popupBox).hide();				$('.notfound',$popupBox).hide();            	$popupBox.show();            	$popupUL.hide();	            $.getJSON(url + '&callback=?', function (data) {	  				$('.searchLoading',$popupBox).hide();	                if (data && data.length > 0) {	                	data_tmp[typeMap[$srhtype.val()]][kw] = data; //ç¼“å­˜æœç´¢ç»“æœ	                    renderSrhFix(data);	                }	                else{	                	$popupUL.hide().empty();	                	$('.searchLoading',$popupBox).hide();	                	$('.searchError',$popupBox).hide();						$('.notfound',$popupBox).show();	                }	            });            },300);        });        $('.notfound').on('click', function () {            $(this,$popupBox).show()            	.animate({backgroundColor:'#fd6'}, 50,function(){            		$(this).css('backgroundColor','#FFDDDD');            	})                .animate({backgroundColor:'#fd6'},100,function(){                    $(this).css('backgroundColor', '#FFBBBB');                })            	.animate({backgroundColor:'#fd6'}, 150,function(){            		$(this).css('backgroundColor','#FFDDDD');            	})                .animate({backgroundColor:'#fd6'},100,function(){                    $(this).css('backgroundColor', '#FFBBBB');                })            	.animate({backgroundColor:'#fd6'}, 150,function(){            		$(this).css('backgroundColor','#f3f3f3');            	})                ;            //$popupBox.hide();        });        $(document).on('click', function () {            //$popupBox.hide();        });		function additem(value, id){			var ahead = searchEl.val();			//if ( ! /(,|ï¼?)\s*$/.test(ahead) ) {				if ( /(,|ï¼?)\s*.*$/.test(ahead) ) {					ahead = ahead.replace( /(,|ï¼?)\s*.*$/, ', ' ); 					tempids[1] = id				} else {					ahead = '';					tempids[0] = id				}			//}			var _val = ahead + $.trim(value);			var sMatch = ahead.match(/,|, /g);            if(!sMatch){            	_val += ', ';            }			searchEl.val(_val);		}        var _addItem = function(value,id){            return additem(value,id);        };				function replaceItem(value, id) {			var ahead = searchEl.val();			if ( ! /(,|ï¼?)\s*$/.test(ahead) ) { 				if ( /(,|ï¼?)\s*.*$/.test(ahead) ) {					ahead = ahead.replace( /(,|ï¼?)\s*.*$/, ', ' ); 					tempids[1] = id				} else {					ahead = '';					tempids[0] = id				}			}			searchEl.val(ahead + $.trim(value));		}        var _replaceItem = function(value,id){            return replaceItem(value,id);        };		        function renderSrhFix(o) {            $popupUL.empty().show();            $.each(o, function (i, entry) {                $popupUL.append(parse(entry, setting.tmpl))            });            $popupBox.slideDown(120)        }         function parse(data, tpl) {            parseHtml = tpl.replace(/\{(.+?)\}/gi, function (s, t) {                var type = s.replace('{', '').replace('}', '');                if (type == 'type') {                    return $('.search-select-name').text();                }				if ( type == 'title') {					var title = M1905.Util.cutStr(data['title'], 28);					var regTitle = new RegExp(currVal,'gi');					title = title.replace(regTitle,"<b>"+currVal+"</b>");					return title;				}                return data[type];            });            return parseHtml;        }         return {            that:this,            searchEl:searchEl,            tmpids:tempids,            add_item:_addItem            };    }     if($('[data-srhfix_enh]').length){        enh = $('[data-srhfix_enh]').srhfix_enh();    }}(jQuery)});//===========================================================/*mBuffer.ready('colorAnimate', function(){  var $colorCharts = $('.color-chart');  $colorCharts.length && $colorCharts.each(function(i, el) {  var colors = $(el).data('colorani').split(','),  percent = $(el).data('percent');  var endColor = calculateColor(M1905.Util.parseColor(colors[0]), M1905.Util.parseColor(colors[1]), percent/100);  $(el).css({  background: colors[0]  });  $(el).animate({  backgroundColor: endColor,  height: percent + '%'  }, 1000, function(){  $('.text-pc').addClass('active');  });  });  function calculateColor(begin, end, pos) {  var color = 'rgb' + ($.support['rgba'] ? 'a' : '') + '('  + parseInt((begin[0] + pos * (end[0] - begin[0])), 10) + ','  + parseInt((begin[1] + pos * (end[1] - begin[1])), 10) + ','  + parseInt((begin[2] + pos * (end[2] - begin[2])), 10);  if ($.support['rgba']) {  color += ',' + (begin && end ? parseFloat(begin[3] + pos * (end[3] - begin[3])) : 1);  }  color += ')';  return color;  }  })*/